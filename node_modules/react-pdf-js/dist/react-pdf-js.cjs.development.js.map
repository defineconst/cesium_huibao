{"version":3,"file":"react-pdf-js.cjs.development.js","sources":["../src/index.tsx"],"sourcesContent":["import pdfjs from '@bundled-es-modules/pdfjs-dist/build/pdf';\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\n\ntype ComponentProps = {\n  file: string;\n  onDocumentComplete: (numPages: number) => void;\n  page?: number;\n  scale?: number;\n  rotate?: number;\n  cMapUrl?: string;\n  cMapPacked?: boolean;\n  workerSrc?: string;\n  withCredentials?: boolean;\n};\n\nconst Pdf = ({\n  file,\n  onDocumentComplete,\n  page,\n  scale,\n  rotate,\n  cMapUrl,\n  cMapPacked,\n  workerSrc,\n  withCredentials,\n}: ComponentProps) => {\n  const canvasEl = useRef<HTMLCanvasElement>(null);\n  const [, numPages] = usePdf({\n    canvasEl,\n    file,\n    page,\n    scale,\n    rotate,\n    cMapUrl,\n    cMapPacked,\n    workerSrc,\n    withCredentials,\n  });\n\n  useEffect(() => {\n    onDocumentComplete(numPages);\n  }, [numPages]);\n\n  return <canvas ref={canvasEl} />;\n};\n\nPdf.defaultProps = {\n  onDocumentComplete: () => {},\n};\n\ntype HookProps = {\n  canvasEl: React.RefObject<HTMLCanvasElement>;\n  file: string;\n  scale?: number;\n  rotate?: number;\n  page?: number;\n  cMapUrl?: string;\n  cMapPacked?: boolean;\n  workerSrc?: string;\n  withCredentials?: boolean;\n};\n\nexport const usePdf = ({\n  canvasEl,\n  file,\n  scale = 1,\n  rotate = 0,\n  page = 1,\n  cMapUrl,\n  cMapPacked,\n  workerSrc = '//cdnjs.cloudflare.com/ajax/libs/pdf.js/2.1.266/pdf.worker.js',\n  withCredentials = false,\n}: HookProps) => {\n  const [pdf, setPdf] = useState();\n\n  useEffect(() => {\n    pdfjs.GlobalWorkerOptions.workerSrc = workerSrc;\n  }, []);\n\n  useEffect(() => {\n    const config: pdfjs.PDFSource = { url: file, withCredentials };\n    if (cMapUrl) {\n      config.cMapUrl = cMapUrl;\n      config.cMapPacked = cMapPacked;\n    }\n    pdfjs.getDocument(config).promise.then(setPdf);\n  }, [file, withCredentials]);\n\n  // handle changes\n  useEffect(() => {\n    if (pdf) {\n      pdf.getPage(page).then((p: any) => drawPDF(p));\n    }\n  }, [pdf, page, scale, rotate, canvasEl]);\n\n  // draw a page of the pdf\n  const drawPDF = (page: any) => {\n    // Because this page's rotation option overwrites pdf default rotation value,\n    // calculating page rotation option value from pdf default and this component prop rotate.\n    const rotation = rotate === 0 ? page.rotate : page.rotate + rotate;\n    let dpRatio = 1;\n    dpRatio = window.devicePixelRatio;\n    const adjustedScale = scale * dpRatio;\n    const viewport = page.getViewport({ scale: adjustedScale, rotation });\n    const canvas = canvasEl.current;\n    if (!canvas) {\n      return;\n    }\n    const canvasContext = canvas.getContext('2d');\n    canvas.style.width = `${viewport.width / dpRatio}px`;\n    canvas.style.height = `${viewport.height / dpRatio}px`;\n    canvas.height = viewport.height;\n    canvas.width = viewport.width;\n    const renderContext = {\n      canvasContext,\n      viewport,\n    };\n    page.render(renderContext);\n  };\n\n  const loading = useMemo(() => !pdf, [pdf]);\n  const numPages = useMemo(() => (pdf ? pdf._pdfInfo.numPages : null), [pdf]);\n\n  return [loading, numPages];\n};\n\nexport default Pdf;\n"],"names":["Pdf","file","onDocumentComplete","page","scale","rotate","cMapUrl","cMapPacked","workerSrc","withCredentials","canvasEl","useRef","numPages","usePdf","useEffect","React","ref","defaultProps","pdf","setPdf","useState","pdfjs","GlobalWorkerOptions","config","url","getDocument","promise","then","getPage","p","drawPDF","rotation","dpRatio","window","devicePixelRatio","adjustedScale","viewport","getViewport","canvas","current","canvasContext","getContext","style","width","height","renderContext","render","loading","useMemo","_pdfInfo"],"mappings":"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"}