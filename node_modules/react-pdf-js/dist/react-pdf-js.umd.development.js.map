{"version":3,"file":"react-pdf-js.umd.development.js","sources":["../src/index.tsx"],"sourcesContent":["import pdfjs from '@bundled-es-modules/pdfjs-dist/build/pdf';\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\n\ntype ComponentProps = {\n  file: string;\n  onDocumentComplete: (numPages: number) => void;\n  page?: number;\n  scale?: number;\n  rotate?: number;\n  cMapUrl?: string;\n  cMapPacked?: boolean;\n  workerSrc?: string;\n  withCredentials?: boolean;\n};\n\nconst Pdf = ({\n  file,\n  onDocumentComplete,\n  page,\n  scale,\n  rotate,\n  cMapUrl,\n  cMapPacked,\n  workerSrc,\n  withCredentials,\n}: ComponentProps) => {\n  const canvasEl = useRef<HTMLCanvasElement>(null);\n  const [, numPages] = usePdf({\n    canvasEl,\n    file,\n    page,\n    scale,\n    rotate,\n    cMapUrl,\n    cMapPacked,\n    workerSrc,\n    withCredentials,\n  });\n\n  useEffect(() => {\n    onDocumentComplete(numPages);\n  }, [numPages]);\n\n  return <canvas ref={canvasEl} />;\n};\n\nPdf.defaultProps = {\n  onDocumentComplete: () => {},\n};\n\ntype HookProps = {\n  canvasEl: React.RefObject<HTMLCanvasElement>;\n  file: string;\n  scale?: number;\n  rotate?: number;\n  page?: number;\n  cMapUrl?: string;\n  cMapPacked?: boolean;\n  workerSrc?: string;\n  withCredentials?: boolean;\n};\n\nexport const usePdf = ({\n  canvasEl,\n  file,\n  scale = 1,\n  rotate = 0,\n  page = 1,\n  cMapUrl,\n  cMapPacked,\n  workerSrc = '//cdnjs.cloudflare.com/ajax/libs/pdf.js/2.1.266/pdf.worker.js',\n  withCredentials = false,\n}: HookProps) => {\n  const [pdf, setPdf] = useState();\n\n  useEffect(() => {\n    pdfjs.GlobalWorkerOptions.workerSrc = workerSrc;\n  }, []);\n\n  useEffect(() => {\n    const config: pdfjs.PDFSource = { url: file, withCredentials };\n    if (cMapUrl) {\n      config.cMapUrl = cMapUrl;\n      config.cMapPacked = cMapPacked;\n    }\n    pdfjs.getDocument(config).promise.then(setPdf);\n  }, [file, withCredentials]);\n\n  // handle changes\n  useEffect(() => {\n    if (pdf) {\n      pdf.getPage(page).then((p: any) => drawPDF(p));\n    }\n  }, [pdf, page, scale, rotate, canvasEl]);\n\n  // draw a page of the pdf\n  const drawPDF = (page: any) => {\n    // Because this page's rotation option overwrites pdf default rotation value,\n    // calculating page rotation option value from pdf default and this component prop rotate.\n    const rotation = rotate === 0 ? page.rotate : page.rotate + rotate;\n    let dpRatio = 1;\n    dpRatio = window.devicePixelRatio;\n    const adjustedScale = scale * dpRatio;\n    const viewport = page.getViewport({ scale: adjustedScale, rotation });\n    const canvas = canvasEl.current;\n    if (!canvas) {\n      return;\n    }\n    const canvasContext = canvas.getContext('2d');\n    canvas.style.width = `${viewport.width / dpRatio}px`;\n    canvas.style.height = `${viewport.height / dpRatio}px`;\n    canvas.height = viewport.height;\n    canvas.width = viewport.width;\n    const renderContext = {\n      canvasContext,\n      viewport,\n    };\n    page.render(renderContext);\n  };\n\n  const loading = useMemo(() => !pdf, [pdf]);\n  const numPages = useMemo(() => (pdf ? pdf._pdfInfo.numPages : null), [pdf]);\n\n  return [loading, numPages];\n};\n\nexport default Pdf;\n"],"names":["Pdf","file","onDocumentComplete","page","scale","rotate","cMapUrl","cMapPacked","workerSrc","withCredentials","canvasEl","useRef","numPages","usePdf","useEffect","React","ref","defaultProps","pdf","setPdf","useState","pdfjs","GlobalWorkerOptions","config","url","getDocument","promise","then","getPage","p","drawPDF","rotation","dpRatio","window","devicePixelRatio","adjustedScale","viewport","getViewport","canvas","current","canvasContext","getContext","style","width","height","renderContext","render","loading","useMemo","_pdfInfo"],"mappings":"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"}