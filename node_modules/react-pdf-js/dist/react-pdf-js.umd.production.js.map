{"version":3,"file":"react-pdf-js.umd.production.js","sources":["../src/index.tsx"],"sourcesContent":["import pdfjs from '@bundled-es-modules/pdfjs-dist/build/pdf';\nimport React, { useState, useEffect, useRef, useMemo } from 'react';\n\ntype ComponentProps = {\n  file: string;\n  onDocumentComplete: (numPages: number) => void;\n  page?: number;\n  scale?: number;\n  rotate?: number;\n  cMapUrl?: string;\n  cMapPacked?: boolean;\n  workerSrc?: string;\n  withCredentials?: boolean;\n};\n\nconst Pdf = ({\n  file,\n  onDocumentComplete,\n  page,\n  scale,\n  rotate,\n  cMapUrl,\n  cMapPacked,\n  workerSrc,\n  withCredentials,\n}: ComponentProps) => {\n  const canvasEl = useRef<HTMLCanvasElement>(null);\n  const [, numPages] = usePdf({\n    canvasEl,\n    file,\n    page,\n    scale,\n    rotate,\n    cMapUrl,\n    cMapPacked,\n    workerSrc,\n    withCredentials,\n  });\n\n  useEffect(() => {\n    onDocumentComplete(numPages);\n  }, [numPages]);\n\n  return <canvas ref={canvasEl} />;\n};\n\nPdf.defaultProps = {\n  onDocumentComplete: () => {},\n};\n\ntype HookProps = {\n  canvasEl: React.RefObject<HTMLCanvasElement>;\n  file: string;\n  scale?: number;\n  rotate?: number;\n  page?: number;\n  cMapUrl?: string;\n  cMapPacked?: boolean;\n  workerSrc?: string;\n  withCredentials?: boolean;\n};\n\nexport const usePdf = ({\n  canvasEl,\n  file,\n  scale = 1,\n  rotate = 0,\n  page = 1,\n  cMapUrl,\n  cMapPacked,\n  workerSrc = '//cdnjs.cloudflare.com/ajax/libs/pdf.js/2.1.266/pdf.worker.js',\n  withCredentials = false,\n}: HookProps) => {\n  const [pdf, setPdf] = useState();\n\n  useEffect(() => {\n    pdfjs.GlobalWorkerOptions.workerSrc = workerSrc;\n  }, []);\n\n  useEffect(() => {\n    const config: pdfjs.PDFSource = { url: file, withCredentials };\n    if (cMapUrl) {\n      config.cMapUrl = cMapUrl;\n      config.cMapPacked = cMapPacked;\n    }\n    pdfjs.getDocument(config).promise.then(setPdf);\n  }, [file, withCredentials]);\n\n  // handle changes\n  useEffect(() => {\n    if (pdf) {\n      pdf.getPage(page).then((p: any) => drawPDF(p));\n    }\n  }, [pdf, page, scale, rotate, canvasEl]);\n\n  // draw a page of the pdf\n  const drawPDF = (page: any) => {\n    // Because this page's rotation option overwrites pdf default rotation value,\n    // calculating page rotation option value from pdf default and this component prop rotate.\n    const rotation = rotate === 0 ? page.rotate : page.rotate + rotate;\n    let dpRatio = 1;\n    dpRatio = window.devicePixelRatio;\n    const adjustedScale = scale * dpRatio;\n    const viewport = page.getViewport({ scale: adjustedScale, rotation });\n    const canvas = canvasEl.current;\n    if (!canvas) {\n      return;\n    }\n    const canvasContext = canvas.getContext('2d');\n    canvas.style.width = `${viewport.width / dpRatio}px`;\n    canvas.style.height = `${viewport.height / dpRatio}px`;\n    canvas.height = viewport.height;\n    canvas.width = viewport.width;\n    const renderContext = {\n      canvasContext,\n      viewport,\n    };\n    page.render(renderContext);\n  };\n\n  const loading = useMemo(() => !pdf, [pdf]);\n  const numPages = useMemo(() => (pdf ? pdf._pdfInfo.numPages : null), [pdf]);\n\n  return [loading, numPages];\n};\n\nexport default Pdf;\n"],"names":["Pdf","file","onDocumentComplete","page","scale","rotate","cMapUrl","cMapPacked","workerSrc","withCredentials","canvasEl","useRef","numPages","usePdf","useEffect","React","ref","defaultProps","pdf","setPdf","useState","pdfjs","GlobalWorkerOptions","config","url","getDocument","promise","then","getPage","p","drawPDF","rotation","dpRatio","window","devicePixelRatio","adjustedScale","viewport","getViewport","canvas","current","canvasContext","getContext","style","width","height","renderContext","render","loading","useMemo","_pdfInfo"],"mappings":"uaAeA,MAAMA,EAAM,EACVC,KAAAA,EACAC,mBAAAA,EACAC,KAAAA,EACAC,MAAAA,EACAC,OAAAA,EACAC,QAAAA,EACAC,WAAAA,EACAC,UAAAA,EACAC,gBAAAA,YAEMC,EAAWC,SAA0B,QAClCC,GAAYC,EAAO,CAC1BH,SAAAA,EACAT,KAAAA,EACAE,KAAAA,EACAC,MAAAA,EACAC,OAAAA,EACAC,QAAAA,EACAC,WAAAA,EACAC,UAAAA,EACAC,gBAAAA,WAGFK,YAAU,KACRZ,EAAmBU,IAClB,CAACA,IAEGG,0BAAQC,IAAKN,KAGtBV,EAAIiB,aAAe,CACjBf,mBAAoB,cAeTW,EAAS,EACpBH,SAAAA,EACAT,KAAAA,EACAG,MAAAA,EAAQ,EACRC,OAAAA,EAAS,EACTF,KAAAA,EAAO,EACPG,QAAAA,EACAC,WAAAA,EACAC,UAAAA,EAAY,gEACZC,gBAAAA,GAAkB,YAEXS,EAAKC,GAAUC,aAEtBN,YAAU,KACRO,EAAMC,oBAAoBd,UAAYA,GACrC,IAEHM,YAAU,WACFS,EAA0B,CAAEC,IAAKvB,EAAMQ,gBAAAA,GACzCH,IACFiB,EAAOjB,QAAUA,EACjBiB,EAAOhB,WAAaA,GAEtBc,EAAMI,YAAYF,GAAQG,QAAQC,KAAKR,IACtC,CAAClB,EAAMQ,IAGVK,YAAU,KACJI,GACFA,EAAIU,QAAQzB,GAAMwB,KAAME,GAAWC,EAAQD,KAE5C,CAACX,EAAKf,EAAMC,EAAOC,EAAQK,UAGxBoB,EAAW3B,UAGT4B,EAAsB,IAAX1B,EAAeF,EAAKE,OAASF,EAAKE,OAASA,MACxD2B,EAAU,EACdA,EAAUC,OAAOC,uBACXC,EAAgB/B,EAAQ4B,EACxBI,EAAWjC,EAAKkC,YAAY,CAAEjC,MAAO+B,EAAeJ,SAAAA,IACpDO,EAAS5B,EAAS6B,YACnBD,eAGCE,EAAgBF,EAAOG,WAAW,MACxCH,EAAOI,MAAMC,SAAWP,EAASO,MAAQX,MACzCM,EAAOI,MAAME,UAAYR,EAASQ,OAASZ,MAC3CM,EAAOM,OAASR,EAASQ,OACzBN,EAAOK,MAAQP,EAASO,YAClBE,EAAgB,CACpBL,cAAAA,EACAJ,SAAAA,GAEFjC,EAAK2C,OAAOD,IAGRE,EAAUC,UAAQ,KAAO9B,EAAK,CAACA,IAC/BN,EAAWoC,UAAQ,IAAO9B,EAAMA,EAAI+B,SAASrC,SAAW,KAAO,CAACM,UAE/D,CAAC6B,EAASnC"}